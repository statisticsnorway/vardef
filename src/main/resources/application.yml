micronaut:
  application:
    name: vardef
  security:
    jwks:
      # Token signature verification is performed by the gateway
      enabled: false
    token:
      jwt:
        claims:
          keys:
            dapla: dapla
            dapla-groups: groups
            dapla-teams: teams
            username: preferred_username
          values:
            allowed-audiences:
              - onyxia-api
              - dapla-cli
    intercept-url-map:
      - pattern: /health/**
        http-method: GET
        access: isAnonymous()
      - pattern: /metrics/**
        http-method: GET
        access: isAnonymous()
      - pattern: /prometheus/**
        http-method: GET
        access: isAnonymous()
      - pattern: /docs/**
        http-method: GET
        access: isAnonymous()
      - pattern: /**
        access: isAuthenticated()
  router:
    static-resources:
      swagger:
        paths: classpath:META-INF/swagger
        mapping: /docs/openapi/**
      swagger-ui:
        paths: classpath:META-INF/swagger/views/swagger-ui
        mapping: /docs/swagger/**
      redoc:
        paths: classpath:META-INF/swagger/views/redoc
        mapping: /docs/redoc/**
  openapi:
    property:
      naming:
        strategy: SNAKE_CASE
    views:
      spec: |
        mapping.path=docs/openapi,
        swagger-ui.enabled=true,
        swagger-ui.js.url=/docs/swagger/res/,
        swagger-ui.tagsSorter=Function=(a => a),
        redoc.enabled=true,
        redoc.js.url=/docs/redoc/res/,
        redoc.sort-tags-alphabetically=false,
  serde:
    deserialization:
      ignore-unknown: false
      strict-nullable: true
    serialization:
      inclusion: always
  logger:
    config: logback.xml

  caches:
    classifications:
      maximumSize: 3600
    codes:
      maximumSize: 3600

  server:
    cors:
      enabled: true

    netty:
      access-logger:
        enabled: true
        exclusions:
          - /health/.+
          - /metrics
          - /prometheus
          - /docs/.+
          - /favicon.ico

  http:
    services:
      klass:
        url: https://data.ssb.no/api/klass/v1/
        codes-at: 2024-08-01
        health-check: true
        health-check-interval: 15s
      vardok:
        url: https://www.ssb.no/a/xml/metadata/conceptvariable/vardok/
      dapla-team-api:
        url: https://dapla-team-api.intern.test.ssb.no
        health-check: true
        health-check-interval: 15s
        health-check-uri: /api-docs
      keycloak:
        url: https://auth.test.ssb.no/
        clientId: vardef-to-dapla-team-api-m2m
        clientSecret: ${KEYCLOAK_CLIENT_SECRET}
        health-check: true
        health-check-interval: 15s

  klass-web:
    url:
      en: https://www.ssb.no/en/klass
      nb: https://www.ssb.no/klass

# Allow unauthenticated access
endpoints:
  all:
    port: 8090
  environments:
    enabled: true
    sensitive: false
  health:
    sensitive: false
    details-visible: ANONYMOUS
    service-http-client:
      enabled: true
    monitor:
      enabled: true
  metrics:
    sensitive: false
    enabled: true
    tags:
      application: vardef
    export:
      prometheus:
        enabled: true
        descriptions: true
        step: PT1M

jackson:
  xml:
    enabled: true
